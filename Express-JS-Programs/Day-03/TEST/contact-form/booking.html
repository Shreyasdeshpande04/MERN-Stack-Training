<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Travel Booking Form</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .quantity-controls button {
      width: 30px;
      height: 30px;
    }
    .quantity-controls {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    /* Custom Message Box Styles */
    .message-box {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      z-index: 1000;
      text-align: center;
      display: none; /* Hidden by default */
      width: 80%;
      max-width: 400px;
    }
    .message-box.show {
      display: block;
    }
    .message-box button {
      margin-top: 15px;
      padding: 8px 20px;
      cursor: pointer;
    }
    .message-box.success {
      border: 2px solid #28a745;
      color: #28a745;
    }
    .message-box.error {
      border: 2px solid #dc3545;
      color: #dc3545;
    }
  </style>
</head>
<body>
  <div class="container mt-5">
    <h3 class="text-center mb-4">Travel Booking Form</h3>
    <form id="bookingForm">
      <div class="mb-3">
        <label>Username:</label>
        <input type="text" name="username" class="form-control" required>
      </div>

      <div class="mb-3">
        <label>Source:</label>
        <select name="source" class="form-select" onchange="updateInfo()" id="source">
          <option value="">Select Source</option>
       <option value="BANDRA">BANDRA</option>
<option value="COLABA">COLABA</option>
<option value="GHATKOPAR">GHATKOPAR</option>
<option value="GOREGAON">GOREGAON</option>
<option value="KURLA">KURLA</option>
<option value="MULUND">MULUND</option>
<option value="CENTRAL">MUMBAI CENTRAL</option>
<option value="SHIVAJINAGAR">SHIVAJI NAGAR</option>
<option value="VIKROLI">VIKROLI</option>
<option value="WORLI">WORLI</option>
        </select>
      </div>

      <div class="mb-3">
        <label>Destination:</label>
        <input type="text" name="destination" class="form-control" id="destination" readonly>
      </div>

      <div class="mb-2">
        <label>Distance:</label>
        <input type="text" id="distance" class="form-control" readonly>
      </div>

      <div class="mb-2">
        <label>Time (min):</label>
        <input type="text" id="time" class="form-control" readonly>
      </div>

      <div class="mb-2">
        <label>Price per person (₹):</label>
        <input type="text" id="price" class="form-control" value="100" readonly>
      </div>

      <div class="mb-2">
        <label>Number of Persons:</label>
        <div class="quantity-controls">
          <button type="button" onclick="changePersons(-1)">-</button>
          <span id="personCount">1</span>
          <button type="button" onclick="changePersons(1)">+</button>
        </div>
      </div>

      <div class="mb-2">
        <label>Total Cost (₹):</label>
        <input type="text" id="totalCost" class="form-control" readonly>
      </div>

      <button type="submit" class="btn btn-success w-100">Submit</button>
    </form>
  </div>

  <!-- Custom Message Box HTML -->
  <div id="messageBox" class="message-box">
    <p id="messageText"></p>
    <button onclick="closeMessageBox()">OK</button>
  </div>

  <script>
    const distances = {
BANDRA: {"GATEWAY OF INDIA": 18, "MARINE DRIVE": 12, "ELEPHANTA CAVES": 25, "SIDDHIVINAYAK TEMPLE": 8, "MUMBADEVI TEMPLE": 16, "ISKCON TEMPLE": 22, "SANJAY GANDHI NATIONAL PARK": 28, "AAREY FOREST": 20, "TUNGARESHWAR WILDLIFE SANCTUARY": 30},
COLABA: {"GATEWAY OF INDIA": 5, "MARINE DRIVE": 7, "ELEPHANTA CAVES": 10, "SIDDHIVINAYAK TEMPLE": 20, "MUMBADEVI TEMPLE": 12, "ISKCON TEMPLE": 25, "SANJAY GANDHI NATIONAL PARK": 29, "AAREY FOREST": 21, "TUNGARESHWAR WILDLIFE SANCTUARY": 30},
GHATKOPAR: {"GATEWAY OF INDIA": 26, "MARINE DRIVE": 21, "ELEPHANTA CAVES": 15, "SIDDHIVINAYAK TEMPLE": 12, "MUMBADEVI TEMPLE": 19, "ISKCON TEMPLE": 8, "SANJAY GANDHI NATIONAL PARK": 7, "AAREY FOREST": 6, "TUNGARESHWAR WILDLIFE SANCTUARY": 10},
GOREGAON: {"GATEWAY OF INDIA": 24, "MARINE DRIVE": 19, "ELEPHANTA CAVES": 28, "SIDDHIVINAYAK TEMPLE": 14, "MUMBADEVI TEMPLE": 20, "ISKCON TEMPLE": 6, "SANJAY GANDHI NATIONAL PARK": 5, "AAREY FOREST": 8, "TUNGARESHWAR WILDLIFE SANCTUARY": 12},
KURLA: {"GATEWAY OF INDIA": 20, "MARINE DRIVE": 17, "ELEPHANTA CAVES": 23, "SIDDHIVINAYAK TEMPLE": 10, "MUMBADEVI TEMPLE": 15, "ISKCON TEMPLE": 9, "SANJAY GANDHI NATIONAL PARK": 13, "AAREY FOREST": 11, "TUNGARESHWAR WILDLIFE SANCTUARY": 14},
MULUND: {"GATEWAY OF INDIA": 29, "MARINE DRIVE": 24, "ELEPHANTA CAVES": 30, "SIDDHIVINAYAK TEMPLE": 19, "MUMBADEVI TEMPLE": 25, "ISKCON TEMPLE": 10, "SANJAY GANDHI NATIONAL PARK": 12, "AAREY FOREST": 14, "TUNGARESHWAR WILDLIFE SANCTUARY": 16},
CENTRAL: {"GATEWAY OF INDIA": 10, "MARINE DRIVE": 5, "ELEPHANTA CAVES": 18, "SIDDHIVINAYAK TEMPLE": 6, "MUMBADEVI TEMPLE": 9, "ISKCON TEMPLE": 23, "SANJAY GANDHI NATIONAL PARK": 26, "AAREY FOREST": 20, "TUNGARESHWAR WILDLIFE SANCTUARY": 28},
SHIVAJINAGAR: {"GATEWAY OF INDIA": 22, "MARINE DRIVE": 17, "ELEPHANTA CAVES": 27, "SIDDHIVINAYAK TEMPLE": 10, "MUMBADEVI TEMPLE": 15, "ISKCON TEMPLE": 13, "SANJAY GANDHI NATIONAL PARK": 16, "AAREY FOREST": 18, "TUNGARESHWAR WILDLIFE SANCTUARY": 20},
VIKROLI: {"GATEWAY OF INDIA": 28, "MARINE DRIVE": 23, "ELEPHANTA CAVES": 30, "SIDDHIVINAYAK TEMPLE": 18, "MUMBADEVI TEMPLE": 24, "ISKCON TEMPLE": 5, "SANJAY GANDHI NATIONAL PARK": 9, "AAREY FOREST": 7, "TUNGARESHWAR WILDLIFE SANCTUARY": 11},
WORLI: {"GATEWAY OF INDIA": 16, "MARINE DRIVE": 11, "ELEPHANTA CAVES": 20, "SIDDHIVINAYAK TEMPLE": 7, "MUMBADEVI TEMPLE": 13, "ISKCON TEMPLE": 19, "SANJAY GANDHI NATIONAL PARK": 22, "AAREY FOREST": 25, "TUNGARESHWAR WILDLIFE SANCTUARY": 27}
 
    };
    const times = {
BANDRA: {"GATEWAY OF INDIA": 14, "MARINE DRIVE": 19, "ELEPHANTA CAVES": 11, "SIDDHIVINAYAK TEMPLE": 30, "MUMBADEVI TEMPLE": 9, "ISKCON TEMPLE": 26, "SANJAY GANDHI NATIONAL PARK": 13, "AAREY FOREST": 6, "TUNGARESHWAR WILDLIFE SANCTUARY": 17},
COLABA: {"GATEWAY OF INDIA": 15, "MARINE DRIVE": 9, "ELEPHANTA CAVES": 26, "SIDDHIVINAYAK TEMPLE": 8, "MUMBADEVI TEMPLE": 19, "ISKCON TEMPLE": 11, "SANJAY GANDHI NATIONAL PARK": 7, "AAREY FOREST": 24, "TUNGARESHWAR WILDLIFE SANCTUARY": 21},
GHATKOPAR: {"GATEWAY OF INDIA": 7, "MARINE DRIVE": 25, "ELEPHANTA CAVES": 27, "SIDDHIVINAYAK TEMPLE": 10, "MUMBADEVI TEMPLE": 30, "ISKCON TEMPLE": 22, "SANJAY GANDHI NATIONAL PARK": 17, "AAREY FOREST": 13, "TUNGARESHWAR WILDLIFE SANCTUARY": 16},
GOREGAON: {"GATEWAY OF INDIA": 18, "MARINE DRIVE": 14, "ELEPHANTA CAVES": 12, "SIDDHIVINAYAK TEMPLE": 29, "MUMBADEVI TEMPLE": 16, "ISKCON TEMPLE": 21, "SANJAY GANDHI NATIONAL PARK": 23, "AAREY FOREST": 10, "TUNGARESHWAR WILDLIFE SANCTUARY": 30},
KURLA: {"GATEWAY OF INDIA": 11, "MARINE DRIVE": 13, "ELEPHANTA CAVES": 7, "SIDDHIVINAYAK TEMPLE": 15, "MUMBADEVI TEMPLE": 24, "ISKCON TEMPLE": 14, "SANJAY GANDHI NATIONAL PARK": 8, "AAREY FOREST": 22, "TUNGARESHWAR WILDLIFE SANCTUARY": 28},
MULUND: {"GATEWAY OF INDIA": 16, "MARINE DRIVE": 5, "ELEPHANTA CAVES": 22, "SIDDHIVINAYAK TEMPLE": 25, "MUMBADEVI TEMPLE": 17, "ISKCON TEMPLE": 30, "SANJAY GANDHI NATIONAL PARK": 27, "AAREY FOREST": 12, "TUNGARESHWAR WILDLIFE SANCTUARY": 6},
CENTRAL: {"GATEWAY OF INDIA": 8, "MARINE DRIVE": 12, "ELEPHANTA CAVES": 20, "SIDDHIVINAYAK TEMPLE": 14, "MUMBADEVI TEMPLE": 28, "ISKCON TEMPLE": 6, "SANJAY GANDHI NATIONAL PARK": 11, "AAREY FOREST": 15, "TUNGARESHWAR WILDLIFE SANCTUARY": 9},
SHIVAJINAGAR: {"GATEWAY OF INDIA": 27, "MARINE DRIVE": 20, "ELEPHANTA CAVES": 18, "SIDDHIVINAYAK TEMPLE": 19, "MUMBADEVI TEMPLE": 5, "ISKCON TEMPLE": 30, "SANJAY GANDHI NATIONAL PARK": 10, "AAREY FOREST": 17, "TUNGARESHWAR WILDLIFE SANCTUARY": 26},
VIKROLI: {"GATEWAY OF INDIA": 6, "MARINE DRIVE": 7, "ELEPHANTA CAVES": 9, "SIDDHIVINAYAK TEMPLE": 11, "MUMBADEVI TEMPLE": 18, "ISKCON TEMPLE": 28, "SANJAY GANDHI NATIONAL PARK": 16, "AAREY FOREST": 14, "TUNGARESHWAR WILDLIFE SANCTUARY": 13},
WORLI: {"GATEWAY OF INDIA": 12, "MARINE DRIVE": 26, "ELEPHANTA CAVES": 19, "SIDDHIVINAYAK TEMPLE": 20, "MUMBADEVI TEMPLE": 10, "ISKCON TEMPLE": 8, "SANJAY GANDHI NATIONAL PARK": 29, "AAREY FOREST": 27, "TUNGARESHWAR WILDLIFE SANCTUARY": 23}
    };
    const pricePerPerson = 100;
    let persons = 1;
    let currentDestination = ''; // Store the destination from URL

    // Function to show custom message box
    function showMessageBox(message, type) {
      const msgBox = document.getElementById('messageBox');
      const msgText = document.getElementById('messageText');
      msgText.innerText = message;
      msgBox.className = `message-box show ${type}`; // Add type class for styling
    }

    // Function to close custom message box
    function closeMessageBox() {
      document.getElementById('messageBox').className = 'message-box';
    }

    function updateInfo() {
      const src = document.getElementById('source').value;
      const dest = document.getElementById('destination').value; // Use destination from input field
      if (src && dest && distances[src] && distances[src][dest]) {
        document.getElementById('distance').value = distances[src][dest] + " km";
        document.getElementById('time').value = times[src][dest] + " min";
      } else {
        document.getElementById('distance').value = "";
        document.getElementById('time').value = "";
      }
      updateTotal();
    }

    function changePersons(change) {
      persons = Math.max(1, persons + change);
      document.getElementById('personCount').innerText = persons;
      updateTotal();
    }

    function updateTotal() {
      document.getElementById('totalCost').value = persons * pricePerPerson;
    }

    // Initialize destination from URL on page load
    const params = new URLSearchParams(window.location.search);
    const destinationFromURL = params.get("destination");
    if (destinationFromURL) {
      document.getElementById("destination").value = decodeURIComponent(destinationFromURL);
      currentDestination = decodeURIComponent(destinationFromURL); // Store it
    }
    
    // Call updateInfo and updateTotal on page load to populate if source is already selected
    // (though source is initially "Select Source")
    updateInfo(); // This will populate distance and time if source is selected
    updateTotal(); // This will update total cost based on default persons (1)

    document.getElementById('bookingForm').addEventListener('submit', async function (e) {
      e.preventDefault(); // Prevent default form submission (page reload)

      const username = this.username.value;
      const source = this.source.value;
      const destination = this.destination.value;
      const distance = document.getElementById('distance').value;
      const time = document.getElementById('time').value;
      const totalCost = document.getElementById('totalCost').value;

      // Basic validation
      if (!username || !source || !destination || !distance || !time || !totalCost) {
        showMessageBox("Please fill in all required fields and select a source.", "error");
        return;
      }

      const data = {
        username: username,
        source: source,
        destination: destination,
        distance: distance,
        time: time,
        pricePerPerson: pricePerPerson, // Use the constant
        persons: persons, // Use the current persons count
        totalCost: totalCost
      };
      
      try {
        const response = await fetch('/booking', { // Changed endpoint to /booking
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });

        const result = await response.json();

        if (result.success) {
          showMessageBox("✅ Booking stored successfully!", "success");
          // Clear form fields
          document.querySelector('input[name="username"]').value = "";
          document.getElementById("source").value = "";
          document.getElementById("distance").value = "";
          document.getElementById("time").value = "";
          // Reset price per person (it's readonly, so just ensuring value)
          document.getElementById("price").value = pricePerPerson;
          document.getElementById("personCount").innerText = "1";
          document.getElementById("totalCost").value = pricePerPerson;
          persons = 1; // Reset persons count
          document.getElementById("destination").value = currentDestination; // Keep original destination
          updateInfo(); // Re-calculate to clear if source is not selected or to update if it is
        } else {
          showMessageBox(`❌ Failed to store booking: ${result.message || 'Unknown error'}`, "error");
        }
      } catch (error) {
        console.error('Error submitting booking:', error);
        showMessageBox("An error occurred while submitting your booking. Please try again later.", "error");
      }
    });
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>